---
layout: default
title: NW - Switch
parent: Linux
tags:
- linux
---

### 스위치(Switch)
---
> 스위치(Switch)는 네트워크 내에서 통신을 원활하게 하는 것이 주된 목적인 네트워크 장치이다
- OSI 7계층 모델에서 Layer 2에서 작동하므로, Layer 2 헤더까지의 각 데이터 그램만 확인
- Layer 2 헤더에는 Source/Destination MAC 주소와 같이 Hop-To-Hop 전달을 가능하게 하는 정보가 포함되어 있음
- 스위치가 하는 일은 총 4가지 이다. Learning, Flooding, Forwarding, Filtering

> **Learning** : MAC 주소 학습

- 스위치는 뭔가를 받으면 소스/목적지 MAC 주소를 식별하여 MAC Address Table을 생성하고 연결된 디바이스들의 MAC 주소와 각 스위치 포트를 매핑한다. 비어있던 MAC Address Table은 트래픽이 오고 가면서 완성되어가며, 포워딩 시 참조함.

> **Flooding** : 스위치가 목적지 MAC 주소를 모르는 경우

- 만일 스위치가 목적지 MAC 주소를 모르는 프레임을 발견하면 해당 프레임을 수신한 포트를 제외한 모든 각 스위치 포트로 해당 프레임을 복제하여 플러딩(Flood) 한다.

- 연결된 각 디바이스의 NIC가 프레임을 수신하면 목적지 MAC 주소 필드를 확인하여 일치하지 않으면 단순히 프레임을 드랍한다. 만약 일치하는 경우 응답을 생성하여 스위치로 보내고 이를 통해 스위치는 해당 장비의 MAC주소와 스위치 포트를 연결하여 MAC Address Table을 업데이트 한다.

- Broadcasts와의 차이?: Broadcast 프레임은 목적지 MAC 주소를 로컬 네트워크 내의 모든 디바이스를 대상으로 하기 때문에, 목적지 MAC 주소 필드는 Special Address인 ffff.ffff.ffff로 설정된다. 이 때 스위치는 매핑된 MAC 주소<->스위치 포트를 학습할 수 없기 때문에 플러딩(flood)으로 작동하게 된다. 따라서, 엄밀히 말하면 Broadcast는 프레임이 지닐 수 있는 특정 형식으로, 플러딩(Flood)은 그에 따라 스위치가 취하는 액션으로 구분할 수 있다. 즉, 브로드캐스팅 자체는 스위치의 기능이 아니다.

> **Forwarding** : 포워딩의 대표적인 3가지 methods

1. Store and Forward
    - 포워딩을 하기 전 메모리 버퍼에 전체 프레임(헤더+데이터)을 복사한 후에 프레임 상태를 검사(inspect)
    - 느리지만 에러 식별 및 트래픽 우선순위 결정과 같은 추가적인 기능을 활용할 수 있음
2. Cut-Through
    - 목적지 MAC 주소만 확인하고 포워딩
    - 빠르지만 에러 식별 및 추가기능 활용 불가
3. Fragment Free
    - 프레임의 첫 64 Bytes 까지만 검사(inspect)한 뒤에 포워딩
    - 만일 전송 단계에서 에러가 발생할 경우 첫 64 Bytes 이내에서 발생한것임을 알 수 있음
        - 빠른 전송 가능
        - 전체 프레임을 저장하지 않기 때문에 메모리 버퍼 절약 가능

> **Filtering** : 

- 스위치는 프레임을 받은 포트와 동일한 포트로 프레임을 재전달하지 않는다.(Flooding 시 주로 발생)
- 드물게 호스트의 에러 등으로 인해 자신의 MAC 주소를 목적지 주소로 하여 프레임을 전송할 때가 있다. 이런 일이 발생하면 스위치는 필터링을 통해 해당 프레임을 폐기(Discard)한다.


> 스위치가 참조하는 주소 테이블, Mac Address Table
- 장비의 각 스위치 포트에 연결된 장치의 MAC 주소를 매핑하는 테이블로, 수신된 프레임의 Source MAC 주소 필드를 확인한 뒤에 채워진다.
- 일반적인 스위치에는 24~48개, 최대 96개 또는 그 이상의 많은 포트가 있음
- 프레임 포워딩(Forward)을 위해 스위치는 MAC Address Table의 목적지 MAC 주소를 확인하여 어떤 포트를 사용할지 판단한다.



### Router
---
